
* 詳細情報

** 辞書詳細：( defalut: analysis.dictionary )

　　　　辞書はIPADICを元に同字意義語や活用形などを考慮した状態に直して使います。

　　辞書コレクションの構造

　　　　w: 単語 or 活用候補配列
　　　　　　　　単語か活用候補


　　　　h: 先頭文字配列
　　　　　　　　最長マッチにかける為のインデックス用の要素

　　　　l: 文字列長　　　　
　　　　　　　　最長マッチにかける為のインデックス用の要素

　　　　s: 品詞優先度
　　　　　　　　最長マッチにかける為のインデックス用の要素

　　　　c: コスト
　　　　　　　　未使用（品詞で別けた方が結果が良かったので使わなくなった）

　　　　f: 活用系区分
　　　　　　　　1: 打ち切り可能
　　　　　　　　2: 後ろ助詞、助動詞必須
　　　　　　　　3: 後ろ動詞可能（通常は動詞＋動詞は無い）
　　　　　　　　4: 後ろ名詞優先

　　　　　※ この辺は今後チューニングが必要

　　インデックス：

　　　　{h:1,l:-1,s:1}
　　　　{w:1}
　　　　{t:1}

** 辞書ビルド：
　　　　
　　　　gendic.sh の --nheads オプションは単語のインデックスに含める先頭文字数です。（デフォルト２）
　　　　　この値は辞書コレクションの".meta"レコードに保存され、解析時にも使われます。

　　　　nheadsを大きくすると、インデックスサイズが大きくなり、クエリー回数が増え、比較回数が減ります。


　　　　　例えばnheads=2の場合『インデックス』という単語では{ h: ["イ","イン"],l:6,s:300} この様にインデックスを張ります。

　　　　　　解析時に最初に以下のクエリーを試します。


　　　　　『イン』で始まる単語を長い順：
　　　　　　　db.dictionary.find({h:"イン"}).sort({l:-1,s:1})
　　　　　　　　- インフォメーション　　　　　　　
　　　　　　　　- インターナショナル
　　　　　　　　- インフォメーション　　　　　　　
　　　　　　　　- インターネット
　　　　　　　　- インデックス
　　　　　　　　- インデアン

　　　　　　　この場合、インデックスにマッチさせる為には５回の比較が必要です。
　　　　　　　　　　　　
　　　　　　ところがnheads=3ではこうなります。

　　　　　『インデ』で始まる単語を長い順：
　　　　　　　db.dictionary.find({h:"インデ"}).sort({l:-1,s:1})
　　　　　　　　- インデックス
　　　　　　　　- インデアン

　　　　　　　この場合、１回の比較でマッチできます。


　　　　nheadsを４以上にしても効果は薄くデメリットが目立つようになるようです。

　　　　事実上、nheadsは２or３なのですが、２＝＞３ではクエリー回数は約１．５倍。比較回数（＝辞書からフェッチする単語数）は約１／４。
　　　　データ転送量が４倍違うにも関わらず、性能はほぼ同じか２の方が良い事が多いのです。


** 既知の問題
　MOMONGER-NLPは通常、実用上問題ない程度の精度で解析できますが
　幾つか間違った分割をしてしまうケースが判明しています。

　１．動詞＋名詞のパターンで判定を間違える場合があります。（ほぼ解決済み）

　　　- これを買うとしあわせに、、
　　　- これを買うときは、、



　　　- これ|を|買う|と|しあわせ|に|、、
　　　- これ|を|買う|とき|は|、、

　　　正しくはこの様に分割すべきですが、MOMONGER-NLPでは以下の様に分割してしまいます。

　　　- これ|を|買う|と|しあわせ|に|、、
　　　- これ|を|買う|と|き|は|、、

　　　これは動詞の活用形で、後ろに助詞、助動詞、動詞などが続く可能性がある場合、助詞を優先するようになっているからです。
　　　名詞を優先したり、最長マッチを採用してしまうと

　　　- これ|を|買う|とし|あわせ|に|、、

　　　この様な結果を得てしまい、難しく解決できていません。
　　　これを解くには、もう少し深い探索を実装する必要があるのですが、性能との兼ね合いもあるので保留しています。


　２．外来語がサ変接続する場合

　　　- ビルドする、、

　　　- ビルド|する|、、
　　　正しくはこの様に分割すべきですが、MOMONGER-NLPでは以下の様に分割してしまいます。

　　　- ビルド|す|る|、、

　　　MOMONGER-NLPは連続したアルファベット、数字、カタカナを一般名詞として扱います。
　　　名詞の直後には基本的に動詞は来ないのですが（『アメリカ』する。など）、例外的に『する』に接続する場合があります。
　　　特に『する』はサ行変格活用で厄介な活用をする動詞で、助詞などと誤判定し易く、現状助ける手立てがありません。

　　　どうしてもこのパターンを拾いたい場合は辞書を編集し、この様な単語を登録する必要があります。
　　　　{w:"ビルド", h:["ビ","ビル"] l:3 , c:0, s:0 , t:["名詞","サ変接続"]}


　　　辞書の編集機能はまだ開発中ですが、mongo shellからはこの様に操作します。

　　　　load('../lib/utils.js')
　　　　load('lib/morpho.js')
　　　　var nheads = db.dictionary.findOne({w:'.meta'}).nheads
　　　　var word = {w:'ビルド',l:3,c:0,s:300,t:['名詞','ORG','外来語','サ変接続']}
　　　　var dicword = morpho.forms(nheads,word)
　　		db.dictionary.findAndModify({ query: {w:dicword.w}, update: dicword, upsert: true, new:true});
　
